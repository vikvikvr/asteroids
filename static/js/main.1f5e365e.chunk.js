(this["webpackJsonpasteroids-client"]=this["webpackJsonpasteroids-client"]||[]).push([[0],{13:function(t,e,i){},16:function(t,e,i){"use strict";i.r(e);i(13);var s=i(0),a=i(1),o=i(2),n=i(5),r=i(3),h=i(7),c=i(6),u=function(){function t(){var e,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),this.coords=void 0,this.speed=void 0,this.acceleration=void 0,this.orientation=void 0,this.direction=void 0,this.world=void 0,this.rotationSpeed=void 0,this.angularSpeed=void 0,this.targetDirection=void 0,this.world=a.world||{width:1e3,height:1e3},this.coords={x:(null===a||void 0===a||null===(e=a.coords)||void 0===e?void 0:e.x)||0,y:(null===a||void 0===a||null===(i=a.coords)||void 0===i?void 0:i.y)||0},this.speed=a.speed||0,this.acceleration=a.acceleration||0,this.direction=a.direction||0,this.targetDirection=this.direction,this.orientation=a.orientation||0,this.angularSpeed=a.angularSpeed||0,this.rotationSpeed=a.rotationSpeed||0}return Object(a.a)(t,[{key:"serialize",value:function(){return{coords:Object(o.a)({},this.coords),speed:this.speed,acceleration:this.acceleration,orientation:this.orientation,direction:this.direction,world:this.world,rotationSpeed:this.rotationSpeed}}},{key:"changeRotationDirection",value:function(){this.rotationSpeed*=-1}},{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.updatePosition(),this.approachTargetDirection(),this.orientation+=this.rotationSpeed}},{key:"setTargetDirection",value:function(t){this.targetDirection=t}},{key:"approachTargetDirection",value:function(){this.targetDirection>this.direction?this.direction=Math.min(this.targetDirection,this.direction+this.angularSpeed):this.targetDirection<this.direction&&(this.direction=Math.max(this.targetDirection,this.direction-this.angularSpeed))}},{key:"updatePosition",value:function(){this.coords.x+=Math.cos(this.direction)*this.speed,this.coords.y+=Math.sin(this.direction)*this.speed,this.teleportOffEdges()}},{key:"teleportOffEdges",value:function(){this.coords.x>this.world.width&&(this.coords.x-=this.world.width),this.coords.x<0&&(this.coords.x+=this.world.width),this.coords.y>this.world.height&&(this.coords.y-=this.world.height),this.coords.y<0&&(this.coords.y+=this.world.height)}}]),t}(),d=i(17),l=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),(t=e.call(this,Object(o.a)({},a))).id=void 0,t.type=void 0,t.hitBoxRadius=void 0,t.life=void 0,t.isExpired=void 0,t.expiresAt=void 0,t.id=Object(d.a)(),t.type=a.type||"asteroid",t.hitBoxRadius=a.hitBoxRadius||50,t.isExpired=!1,t.life=1,t.expiresAt=Date.now()+(a.duration||1/0),t}return Object(a.a)(i,[{key:"serialize",value:function(){return Object(o.a)(Object(o.a)({},Object(n.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{id:this.id,type:this.type,hitBoxRadius:this.hitBoxRadius,life:this.life,isExpired:this.isExpired})}},{key:"update",value:function(){Object(n.a)(Object(r.a)(i.prototype),"update",this).call(this),this.isExpired=Date.now()>this.expiresAt}}]),i}(u),p=i(4),v=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),e.call(this,Object(o.a)(Object(o.a)({},t),{},{type:"bullet",hitBoxRadius:3,duration:2e3}))}return Object(a.a)(i,[{key:"update",value:function(){Object(n.a)(Object(r.a)(i.prototype),"update",this).call(this)}},{key:"serialize",value:function(){return Object(n.a)(Object(r.a)(i.prototype),"serialize",this).call(this)}}]),i}(l),f=-Math.PI/2,m=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),(t=e.call(this,Object(o.a)(Object(o.a)({},a),{},{type:"ship",hitBoxRadius:30,direction:f,acceleration:.1,angularSpeed:Math.PI/3/20}))).bullets=[],t.fuel=1,t.ammo=100,t.cargo={ammo:0,fix:0,fuel:0},t.rotationStep=Math.PI/6,t.startingDirection=f,t.rightRotations=0,t.leftRotations=0,t.ACC_SPRINTS=30,t.DEC_SPRINTS=15,t.FUEL_CONSUMPTION=1/3e3,t.sprints=0,t.MAX_SPEED=4,t}return Object(a.a)(i,[{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)Object(n.a)(Object(r.a)(i.prototype),"update",this).call(this),Object(p.remove)(this.bullets,{isExpired:!0}),this.bullets.forEach((function(t){return t.update()})),this.consumeFuel(),this.sprints>0?this.useSprintsToAccelerateForward():this.sprints<0?this.useSprintsToAccelerateBackwards():this.decelerateBackToZero()}},{key:"turnLeft",value:function(){this.setTargetDirection(this.getComputedDirection()-this.rotationStep),this.leftRotations++}},{key:"turnRight",value:function(){this.setTargetDirection(this.getComputedDirection()+this.rotationStep),this.rightRotations++}},{key:"accelerate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.fuel>0&&(this.sprints>0?this.sprints+=this.ACC_SPRINTS:this.sprints=this.ACC_SPRINTS)}},{key:"decelerate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.fuel>0&&(this.sprints<0?this.sprints+=-this.DEC_SPRINTS:this.sprints=-this.DEC_SPRINTS)}},{key:"fire",value:function(){if(!this.ammo)return null;var t=this.makeBullet();return this.bullets.push(t),this.ammo--,t}},{key:"collectBonus",value:function(t){this.cargo[t]++}},{key:"useBonus",value:function(t){if(!this.cargo[t])return!1;switch(t){case"ammo":if(100===this.ammo)return!1;this.ammo=100;break;case"fix":if(1===this.life)return!1;this.life=1;break;case"fuel":if(1===this.fuel)return!1;this.fuel=1}return this.cargo[t]--,!0}},{key:"serialize",value:function(){return Object(o.a)(Object(o.a)({},Object(n.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{bullets:this.bullets.map((function(t){return t.serialize()})),fuel:this.fuel,ammo:this.ammo,cargo:Object(o.a)({},this.cargo)})}},{key:"hasBullet",value:function(t){return Boolean(Object(p.find)(this.bullets,{id:t}))}},{key:"decelerateBackToZero",value:function(){var t;this.speed>0?(t=Math.abs(this.MAX_SPEED-this.speed)/2,this.speed=Math.max(this.speed-this.acceleration*t,0)):this.speed<0&&(t=Math.abs(-this.MAX_SPEED-this.speed)/2,this.speed=Math.min(this.speed+this.acceleration*t,0))}},{key:"useSprintsToAccelerateForward",value:function(){var t=Math.pow(Math.abs(this.MAX_SPEED-this.speed)/2,2);this.speed+=this.acceleration*t,this.sprints--}},{key:"useSprintsToAccelerateBackwards",value:function(){var t=Math.abs(-this.MAX_SPEED-this.speed)/2;this.speed-=this.acceleration*t,this.sprints++}},{key:"consumeFuel",value:function(){0!==this.speed&&(this.fuel=this.fuel-this.FUEL_CONSUMPTION)}},{key:"getComputedDirection",value:function(){var t=(-this.leftRotations+this.rightRotations)*this.rotationStep;return this.startingDirection+t}},{key:"makeBullet",value:function(){return new v({world:this.world,direction:this.direction,coords:this.coords,speed:Math.max(this.speed,0)+6})}}]),i}(l);function w(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2))}function g(t,e){return w(t.coords,e.coords)<t.hitBoxRadius+e.hitBoxRadius}function b(t,e){var i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,o=0;do{if(o>100)throw Error("Could not create randomCoordsFarFrom");o++,i=w(s={x:Math.random()*e.width,y:Math.random()*e.height},t.coords)}while(i<t.hitBoxRadius*a);return s}function y(t,e,i){var s;t<0&&(t+=Math.PI);do{s=i()*Math.PI*2}while(Math.abs(s-t)<=e/2);return s}function O(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t<s?t+e:t>i?t-e:t}function k(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t>=i&&t<=e}function E(t,e,i,s,a){var o=t.x-e.x,n=t.y-e.y,r={x:i.width/2+o,y:i.height/2+n};if(a)return r;var h=function(t,e,i){return{x:O(t.x,e.width,i.width),y:O(t.y,e.height,i.height)}}(r,s,i);return k(h.x,i.width)&&k(h.y,i.height)?h:void 0}var x,j=function(){function t(e,i){Object(s.a)(this,t),this.type=void 0,this.id=void 0,this.coords=void 0,this.type=e,this.id=Object(d.a)(),this.coords=Object(o.a)({},i)}return Object(a.a)(t,[{key:"serialize",value:function(){return{type:this.type,id:this.id,coords:Object(o.a)({},this.coords)}}}]),t}(),T=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(s.a)(this,i),(a=e.call(this,"SHIP_HIT",t.coords)).asteroidId=void 0,a.damage=void 0,a.asteroidId=t.id,a.damage=t.damage,a}return i}(j),R=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t,a){var o;return Object(s.a)(this,i),(o=e.call(this,"BULLET_HIT",t.coords)).bulletId=void 0,o.asteroidId=void 0,o.bulletId=t.id,o.asteroidId=a.id,o}return i}(j),S=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(s.a)(this,i),(a=e.call(this,"GOT_BONUS",t.coords)).bonusId=void 0,a.bonusType=void 0,a.bonusId=t.id,a.bonusType=t.dropType,a}return i}(j),A=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(s.a)(this,i),(a=e.call(this,Object(o.a)(Object(o.a)({},t),{},{hitBoxRadius:30,type:"drop",rotationSpeed:Math.PI/100}))).dropType=void 0,a.rotatingRight=!0,a.rotationCone=Math.PI/12,a.dropType=t.type,a}return Object(a.a)(i,[{key:"update",value:function(){Object(n.a)(Object(r.a)(i.prototype),"update",this).call(this),this.rotatingRight?this.orientation>this.rotationCone&&(this.changeRotationDirection(),this.rotatingRight=!1):this.orientation<-this.rotationCone&&(this.changeRotationDirection(),this.rotatingRight=!0)}},{key:"serialize",value:function(){return Object(o.a)(Object(o.a)({},Object(n.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{dropType:this.dropType})}}]),i}(l),I={large:1,medium:2,small:3},C={large:40,medium:30,small:20},B={large:.2,medium:.15,small:.1},_=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,i);var o=Math.random()>.5?1:-1,n=a.size||"large";return(t=e.call(this,{world:a.world,coords:a.coords,hitBoxRadius:C[n],speed:I[n],type:"asteroid",direction:a.direction||Math.random()*Math.PI*2,rotationSpeed:a.rotationSpeed||o*Math.PI/50})).size=void 0,t.damage=void 0,t.size=n,t.damage=B[n],t}return Object(a.a)(i,[{key:"update",value:function(){Object(n.a)(Object(r.a)(i.prototype),"update",this).call(this)}},{key:"splitSize",value:function(){return"large"===this.size?"medium":"medium"===this.size?"small":null}},{key:"serialize",value:function(){return Object(o.a)(Object(o.a)({},Object(n.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{size:this.size,damage:this.damage})}}]),i}(l),D=function(){function t(e,i){Object(s.a)(this,t),this.state=void 0,this.world=void 0,this.nextBonusSpawnAt=void 0,this.nextAsteroidSpawnAt=void 0,this.asteroidTimer=void 0,this.bonusTimer=void 0,this.HIT_BOX_MULTIPLIER=5,this.CONE_ANGLE=Math.PI/3,this.state=e,this.world=i,this.nextAsteroidSpawnAt=1/0,this.nextBonusSpawnAt=1/0}return Object(a.a)(t,[{key:"getEtas",value:function(){return{asteroids:this.nextAsteroidSpawnAt-Date.now(),bonuses:this.nextBonusSpawnAt-Date.now()}}},{key:"spawnBonus",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.state.bonuses,i=[],s=0;s<(t.count||1);s++){var a=this.makeDropOptions(t);if(!this.allowDropSpawn(a.type))return i;var o=new A(a);e.push(o),i.push(o)}return i}},{key:"spawnAsteroid",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.state.asteroids,i=[],s=0;s<(t.count||1);s++){var a=this.makeAsteroidOptions(t),o=new _(a);e.push(o),i.push(o)}return i}},{key:"asteroidEvery",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.nextAsteroidSpawnAt=Date.now()+t,this.asteroidTimer=setInterval((function(){e.spawnAsteroid(i),e.nextAsteroidSpawnAt=Date.now()+t}),t)}},{key:"bonusEvery",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.nextBonusSpawnAt=Date.now()+t,this.bonusTimer=setInterval((function(){e.spawnBonus(i),e.nextBonusSpawnAt=Date.now()+t}),t)}},{key:"makeDropOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.type||"ammo",i=t.coords||b(this.state.ship,this.world,this.HIT_BOX_MULTIPLIER);return{type:e,world:this.world,coords:i}}},{key:"allowDropSpawn",value:function(t){var e=this.state.bonuses;return Object(p.filter)(e,{dropType:t}).length<3}},{key:"makeAsteroidOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Math.random()*Math.PI*2;return t.notDirection&&(e=y(t.notDirection,this.CONE_ANGLE,Math.random)),{size:t.size||"large",world:this.world,coords:t.coords||b(this.state.ship,this.world,this.HIT_BOX_MULTIPLIER),direction:e}}}]),t}(),M=function(){function t(e){var i;Object(s.a)(this,t),this.state=void 0,this.status="idle",this.world=void 0,this.spawner=void 0,this.gameOverCallback=void 0,this.gameWonCallback=void 0,this.snapshotTimeout=void 0,this.state={asteroids:[],bonuses:[],events:[],ship:new m({world:e,coords:(i=e,{x:i.width/2,y:i.height/2})})},this.world=e,this.spawner=new D(this.state,this.world)}return Object(a.a)(t,[{key:"startLevel",value:function(t){var e=this,i=this.spawner;this.status="playing",i.spawnAsteroid({count:30}),i.asteroidEvery(5e3,{count:6}),i.bonusEvery(3e3,{type:"ammo"}),i.bonusEvery(3e3,{type:"fix"}),i.bonusEvery(3e3,{type:"fuel"}),this.snapshotTimeout=setInterval((function(){t(e.createSnapshot())}),16)}},{key:"onGameOver",value:function(t){this.gameOverCallback=t}},{key:"onGameWon",value:function(t){this.gameWonCallback=t}},{key:"update",value:function(){this.state.ship.update(),this.updateAsteroids(),this.updateBonuses(),this.checkCollisions(),this.checkGameWon(),this.checkGameLost()}},{key:"countAsteroids",value:function(t){return Object(p.filter)(this.state.asteroids,{size:t}).length}},{key:"hasAsteroid",value:function(t){return Boolean(Object(p.find)(this.state.asteroids,{id:t}))}},{key:"getAsteroidsCount",value:function(){return{large:this.countAsteroids("large"),medium:this.countAsteroids("medium"),small:this.countAsteroids("small")}}},{key:"createSnapshot",value:function(){this.update();var t=this.spawner.getEtas(),e=this.state,i=e.ship,s=e.asteroids,a=e.bonuses,o=e.events,n={world:this.world,createdAt:Date.now(),status:this.status,etas:t,ship:i.serialize(),asteroids:s.map((function(t){return t.serialize()})),bonuses:a.map((function(t){return t.serialize()})),events:o.map((function(t){return t.serialize()}))};return this.state.events=[],n}},{key:"checkGameLost",value:function(){this.state.ship.life<=0&&(this.status="lost",this.snapshotTimeout&&clearInterval(this.snapshotTimeout),this.gameOverCallback?this.gameOverCallback():console.log("game over without a callback"))}},{key:"checkGameWon",value:function(){0===this.state.asteroids.length&&(this.status="won",this.snapshotTimeout&&clearInterval(this.snapshotTimeout),this.gameWonCallback?this.gameWonCallback():console.log("game won without a callback"))}},{key:"updateAsteroids",value:function(){this.state.asteroids.forEach((function(t){t.update()}))}},{key:"updateBonuses",value:function(){this.state.bonuses.forEach((function(t){t.update()}))}},{key:"checkCollisions",value:function(){var t=this,e=this.state,i=e.asteroids,s=e.ship,a=e.events,o=e.bonuses;i.forEach((function(e){if(s.bullets.forEach((function(i){if(g(e,i)){var s=new R(i,e);a.push(s),t.processBulletHit(s)}})),g(e,s)){var i=new T(e);a.push(i),t.processShipHit(i)}})),o.forEach((function(e){if(g(e,s)){var i=new S(e);a.push(i),t.processGotBonus(i)}}))}},{key:"processBulletHit",value:function(t){var e=this.state,i=e.asteroids,s=e.ship,a=Object(p.find)(i,{id:t.asteroidId});if(a){this.createLoot(a.coords);var o=a.splitSize();o&&this.spawner.spawnAsteroid({count:2,size:o,coords:a.coords,notDirection:this.state.ship.direction}),Object(p.remove)(i,{id:t.asteroidId})}else console.log("ship has collided with asteroid at previous update");Object(p.remove)(s.bullets,{id:t.bulletId})}},{key:"processShipHit",value:function(t){var e=this.state,i=e.asteroids,s=e.ship;Object(p.remove)(i,{id:t.asteroidId}),s.life-=t.damage}},{key:"processGotBonus",value:function(t){var e=this.state,i=e.ship,s=e.bonuses;i.collectBonus(t.bonusType),Object(p.remove)(s,{id:t.bonusId})}},{key:"createLoot",value:function(t){}}]),t}(),L=function(){function t(){Object(s.a)(this,t),this.engine=void 0,this.container=void 0,this.engine=new M({width:4e3,height:2e3}),this.container=document.getElementById("root")}return Object(a.a)(t,[{key:"start",value:function(){this.on("start",this.handleStartRequest),this.on("command",this.handleCommand)}},{key:"on",value:function(t,e){this.container.addEventListener(t,e.bind(this))}},{key:"handleStartRequest",value:function(t){this.engine.startLevel(this.sendSnapshotToClient.bind(this)),this.container.dispatchEvent(new Event("started"))}},{key:"sendSnapshotToClient",value:function(t){this.container.dispatchEvent(new CustomEvent("snapshot",{detail:t}))}},{key:"handleCommand",value:function(t){var e=t.detail,i=this.engine.state.ship;switch(e){case"turnLeft":return i.turnLeft();case"turnRight":return i.turnRight();case"accelerate":return i.accelerate();case"decelerate":return i.decelerate();case"fire":return i.fire();case"useFix":return i.useBonus("fix");case"useFuel":return i.useBonus("fuel");case"useAmmo":return i.useBonus("ammo")}}}]),t}(),P=i(8),W=i.n(P),z=i(9);!function(t){t[t.ARROW_LEFT=37]="ARROW_LEFT",t[t.ARROW_RIGHT=39]="ARROW_RIGHT",t[t.ARROW_UP=38]="ARROW_UP",t[t.ARROW_DOWN=40]="ARROW_DOWN",t[t.SPACE_BAR=32]="SPACE_BAR",t[t.LETTER_E=69]="LETTER_E",t[t.LETTER_H=72]="LETTER_H",t[t.LETTER_P=80]="LETTER_P",t[t.LETTER_Q=81]="LETTER_Q",t[t.LETTER_W=87]="LETTER_W"}(x||(x={}));var H=function(){function t(e){Object(s.a)(this,t),this.rootElementId=e}return Object(a.a)(t,[{key:"pressed",value:function(t){switch(t){case x.ARROW_LEFT:return this.sendCommand("turnLeft");case x.ARROW_RIGHT:return this.sendCommand("turnRight");case x.ARROW_UP:return this.sendCommand("accelerate");case x.ARROW_DOWN:return this.sendCommand("decelerate");case x.SPACE_BAR:return this.sendCommand("fire");case x.LETTER_E:return this.sendCommand("useFix");case x.LETTER_Q:return this.sendCommand("useFuel");case x.LETTER_W:return this.sendCommand("useAmmo")}}},{key:"sendCommand",value:function(t){document.getElementById(this.rootElementId).dispatchEvent(new CustomEvent("command",{detail:t}))}}]),t}(),F=20;function G(t){return(100*t).toFixed(0)+"%"}var N=function(){function t(e,i){var a;Object(s.a)(this,t),this.p5=void 0,this.anchors=void 0,this.colors=void 0,this.p5=e,this.colors=i,this.anchors=(a={width:e.windowWidth,height:e.windowHeight},{asteroids:{x:F,y:80},ship:{x:F,y:F},timers:{x:a.width-100,y:F},bonuses:{x:F,y:a.height-40}})}return Object(a.a)(t,[{key:"draw",value:function(t){var e=this.anchors,i=e.ship,s=e.asteroids,a=e.timers,o=e.bonuses;this.asteroids(t.asteroids,s),this.ship(t.ship,i),this.timers(t.etas,a),this.bonuses(t.ship,o)}},{key:"asteroids",value:function(t,e){var i=this.p5,s=Object(p.filter)(t,{size:"large"}).length,a=Object(p.filter)(t,{size:"medium"}).length,o=Object(p.filter)(t,{size:"small"}).length;i.text("asteroids: ".concat(s," | ").concat(a," | ").concat(o),e.x,e.y)}},{key:"ship",value:function(t,e){var i=t.ammo,s=t.fuel,a=t.cargo,o=t.life,n=t.speed,r=e.x,h=e.y,c=this.p5;c.fill("white"),c.noStroke(),c.text("fuel: ".concat(G(s)," [").concat(a.fuel,"]"),r,h),c.text("ammo: ".concat(i," [").concat(a.ammo,"]"),r,40),c.text("life: ".concat(G(o)," [").concat(a.fix,"]"),r,60),c.text("speed: ".concat(G(n)),r,100)}},{key:"timers",value:function(t,e){var i=this.p5,s=e.x,a=e.y;i.text("Asteroids in: ".concat((t.asteroids/1e3).toFixed(0),"s"),s,a),i.text("Drops in: ".concat((t.bonuses/1e3).toFixed(0),"s"),s,a+20)}},{key:"bonuses",value:function(t,e){var i=this.p5,s=e.x,a=e.y,o=[t.fuel<.3&&t.cargo.fuel>0,t.ammo<30&&t.cargo.ammo>0,t.life<.3&&t.cargo.fix>0],n=["Q","W","E"],r=[this.colors.fuel,this.colors.ammo,this.colors.life];i.push(),i.translate(s,a),i.rectMode(i.CENTER),i.textAlign(i.CENTER);for(var h=0;h<3;h++){var c=60*h;i.fill(o[h]?r[h]:"rgba(0,0,0,0)"),i.stroke(o[h]?r[h]:this.colors.inactive),i.text(n[h],c,0),i.rect(c,0,40,40,10)}i.pop()}}]),t}(),U={fuel:"#0CA789",inactive:"#808080",life:"#F24726",ammo:"#E6E6E6",hud:"#2D9BF0",space:"black"},X=function(){function t(e,i){Object(s.a)(this,t),this.frames=e,this.coords=i,this.isExpired=!1,this.frameCount=0}return Object(a.a)(t,[{key:"next",value:function(){return this.frameCount>31?(this.isExpired=!0,!1):{coords:this.coords,direction:0,hitBoxRadius:60,orientation:0,image:this.frames[this.frameCount],frameCount:this.frameCount++}}}]),t}(),Q=function(){function t(e){Object(s.a)(this,t),this.p5=void 0,this.stars=[],this.assets=void 0,this.showHitBoxes=void 0,this.screen=void 0,this.gui=void 0,this.snapshot=void 0,this.animations=[],this.p5=e.p5,this.p5.createCanvas(this.p5.windowWidth,this.p5.windowHeight).parent(e.rootElementId),this.assets=e.assets,this.showHitBoxes=e.showHitBoxes||!1,this.screen={width:this.p5.windowWidth,height:this.p5.windowHeight},this.gui=new N(this.p5,U)}return Object(a.a)(t,[{key:"updateSnapshot",value:function(t){t&&(this.snapshot||this.createStars(t.world,200),this.snapshot=t)}},{key:"draw",value:function(){if(this.snapshot)switch(this.snapshot.status){case"playing":this.gameScreen(this.snapshot);break;case"lost":this.gameOverScreen();break;case"won":this.gameWonScreen();break;case"idle":console.log("idle")}}},{key:"gameScreen",value:function(t){this.drawEnvironment(),this.drawGameObjects(t),this.drawAnimations(t),this.gui.draw(t)}},{key:"gameOverScreen",value:function(){var t=this.p5;t.background(U.space),t.fill("yellow"),t.textAlign(t.CENTER),t.text("GAME OVER",t.windowWidth/2,t.windowHeight/2),t.text("press F5 to try again",t.windowWidth/2,t.windowHeight/2+30),t.textAlign(t.LEFT)}},{key:"gameWonScreen",value:function(){var t=this.p5;t.background(U.space),t.fill("yellow"),t.textAlign(t.CENTER),t.text("GAME WON!",t.windowWidth/2,t.windowHeight/2),t.text("press F5 to try again",t.windowWidth/2,t.windowHeight/2+30),t.textAlign(t.LEFT)}},{key:"drawEnvironment",value:function(){var t=this.p5,e=this.stars;t.background(U.space),this.drawStars(e)}},{key:"drawGameObjects",value:function(t){var e=t.ship,i=t.bonuses,s=t.asteroids;this.drawBullets(e.bullets),this.drawShip(e),this.drawBonuses(i),this.drawAsteroids(s)}},{key:"drawAnimations",value:function(t){var e=this;t.events.forEach((function(t){"BULLET_HIT"!==t.type&&"SHIP_HIT"!==t.type||e.animations.push(new X(e.assets.explosionAnimation,t.coords))})),this.animations.forEach((function(t){var i=t.next();i&&e.drawGameObject(i,{image:i.image})})),this.animations=this.animations.filter((function(t){return!t.isExpired}))}},{key:"createStars",value:function(t,e){for(var i=0;i<e;i++)this.stars.push({x:Math.random()*t.width,y:Math.random()*t.height,radius:Math.random()>.5?2:1})}},{key:"drawableCoords",value:function(t){var e,i;return E(t,(null===(e=this.snapshot)||void 0===e?void 0:e.ship.coords)||{x:0,y:0},this.screen,(null===(i=this.snapshot)||void 0===i?void 0:i.world)||{width:1e3,height:1e3})}},{key:"drawStars",value:function(t){var e=this,i=this.p5;i.noStroke(),i.fill("white"),t.forEach((function(t){var s=e.drawableCoords(t);s&&i.circle(s.x,s.y,t.radius)}))}},{key:"drawBonuses",value:function(t){var e=this;t.forEach((function(t){e.drawGameObject(t,{image:e.assets.images[t.dropType]})}))}},{key:"drawAsteroids",value:function(t){var e=this;t.forEach((function(t){e.drawGameObject(t,{image:e.assets.images.asteroid})}))}},{key:"drawGameObject",value:function(t,e){var i=this.p5,s=this.drawableCoords(t.coords);if(!s)return!1;var a=2*t.hitBoxRadius;return i.imageMode(i.CENTER),i.push(),i.translate(s.x,s.y),i.rotate(t.orientation),i.rotate(e.rotateDirection?t.direction:0),i.rotate(e.rotationOffset?e.rotationOffset:0),i.image(e.image,0,0,a,a),this.showHitBoxes&&(i.noFill(),i.stroke("red"),i.circle(0,0,a)),i.pop(),!0}},{key:"drawShip",value:function(t){this.drawGameObject(t,{image:this.assets.images.ship,rotateDirection:!0,rotationOffset:Math.PI/2})}},{key:"drawBullets",value:function(t){var e=this;t.forEach((function(t){e.drawGameObject(t,{image:e.assets.images.bullet})}))}}]),t}(),q="root";function J(t,e){return new Promise((function(i,s){t.loadImage(e,(function(t){i(t)}),(function(t){s(t)}))}))}function Z(t){return V.apply(this,arguments)}function V(){return(V=Object(z.a)(W.a.mark((function t(e){var i,s,a,o,n;return W.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=[],t.prev=1,s=0;case 3:if(!(s<=31)){t.next=13;break}return a=s.toString().padStart(2,"0"),o="./assets/explosion/expl_06_00".concat(a,".png"),t.next=8,J(e,o);case 8:n=t.sent,i.push(n);case 10:s++,t.next=3;break;case 13:t.next=19;break;case 15:throw t.prev=15,t.t0=t.catch(1),console.error(t.t0),Error("Could not load explosion animation");case 19:return t.abrupt("return",i);case 20:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function K(t){return{asteroid:t.loadImage("./assets/asteroid.png"),ship:t.loadImage("./assets/ship1.png"),fix:t.loadImage("./assets/fix.png"),ammo:t.loadImage("./assets/ammo.png"),fuel:t.loadImage("./assets/fuel.png"),bullet:t.loadImage("./assets/bullet.png")}}var Y=function(t){var e,i,s=new H(q),a={images:{},explosionAnimation:[]};t.preload=Object(z.a)(W.a.mark((function e(){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.images=K(t),e.next=3,Z(t);case 3:a.explosionAnimation=e.sent;case 4:case"end":return e.stop()}}),e)}))),t.setup=function(){var s=document.getElementById(q);s.addEventListener("snapshot",(function(t){i=t.detail})),setTimeout((function(){s.dispatchEvent(new Event("start"))}),1e3),t.frameRate(60),e=new Q({p5:t,assets:a,rootElementId:q,showHitBoxes:!1})},t.keyPressed=function(){s.pressed(t.keyCode)},t.draw=function(){try{e.updateSnapshot(i)}catch(t){console.error("Failed to update snapshot",t)}try{e.draw()}catch(t){console.error("Failed to draw",t)}}},$=i(11),tt=i.n($);(new L).start(),new tt.a(Y)}},[[16,1,2]]]);
//# sourceMappingURL=main.1f5e365e.chunk.js.map