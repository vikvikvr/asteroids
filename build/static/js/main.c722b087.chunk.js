(this["webpackJsonpasteroids-client"]=this["webpackJsonpasteroids-client"]||[]).push([[0],{13:function(t,e,i){},16:function(t,e,i){"use strict";i.r(e);i(13);var s=i(0),a=i(1),n=i(2),o=i(4),r=i(3),h=i(6),c=i(5),d=function(){function t(){var e,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),this.coords=void 0,this.speed=void 0,this.acceleration=void 0,this.orientation=void 0,this.direction=void 0,this.world=void 0,this.rotationSpeed=void 0,this.angularSpeed=void 0,this.targetDirection=void 0,this.world=a.world||{width:1e3,height:1e3},this.coords={x:(null===a||void 0===a||null===(e=a.coords)||void 0===e?void 0:e.x)||0,y:(null===a||void 0===a||null===(i=a.coords)||void 0===i?void 0:i.y)||0},this.speed=a.speed||0,this.acceleration=a.acceleration||0,this.direction=a.direction||0,this.targetDirection=this.direction,this.orientation=a.orientation||0,this.angularSpeed=a.angularSpeed||0,this.rotationSpeed=a.rotationSpeed||0}return Object(a.a)(t,[{key:"serialize",value:function(){return{coords:Object(n.a)({},this.coords),speed:this.speed,acceleration:this.acceleration,orientation:this.orientation,direction:this.direction,world:this.world,rotationSpeed:this.rotationSpeed}}},{key:"changeRotationDirection",value:function(){this.rotationSpeed*=-1}},{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.updatePosition(),this.approachTargetDirection(),this.orientation+=this.rotationSpeed}},{key:"setTargetDirection",value:function(t){this.targetDirection=t}},{key:"approachTargetDirection",value:function(){this.targetDirection>this.direction?this.direction=Math.min(this.targetDirection,this.direction+this.angularSpeed):this.targetDirection<this.direction&&(this.direction=Math.max(this.targetDirection,this.direction-this.angularSpeed))}},{key:"updatePosition",value:function(){this.coords.x+=Math.cos(this.direction)*this.speed,this.coords.y+=Math.sin(this.direction)*this.speed,this.teleportOffEdges()}},{key:"teleportOffEdges",value:function(){this.coords.x>this.world.width&&(this.coords.x-=this.world.width),this.coords.x<0&&(this.coords.x+=this.world.width),this.coords.y>this.world.height&&(this.coords.y-=this.world.height),this.coords.y<0&&(this.coords.y+=this.world.height)}}]),t}(),u=i(17),l=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),(t=e.call(this,Object(n.a)({},a))).id=void 0,t.type=void 0,t.hitBoxRadius=void 0,t.life=void 0,t.isExpired=void 0,t.tail=[],t.expiresAt=void 0,t.hasTail=void 0,t.tailLength=void 0,t.id=Object(u.a)(),t.type=a.type||"asteroid",t.hitBoxRadius=a.hitBoxRadius||50,t.isExpired=!1,t.life=1,t.expiresAt=Date.now()+(a.duration||1/0),t.hasTail=a.hasTail||!1,t.tailLength=a.tailLength||20,t}return Object(a.a)(i,[{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{id:this.id,type:this.type,hitBoxRadius:this.hitBoxRadius,life:this.life,isExpired:this.isExpired,tail:this.tail})}},{key:"update",value:function(){Object(o.a)(Object(r.a)(i.prototype),"update",this).call(this),this.isExpired=Date.now()>this.expiresAt,this.hasTail&&(this.tail.length===this.tailLength&&this.tail.shift(),this.tail.push(Object(n.a)({},this.coords)))}}]),i}(d),p=i(7),v=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),e.call(this,Object(n.a)(Object(n.a)({},t),{},{type:"bullet",hitBoxRadius:3,duration:2e3}))}return Object(a.a)(i,[{key:"update",value:function(){Object(o.a)(Object(r.a)(i.prototype),"update",this).call(this)}},{key:"serialize",value:function(){return Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)}}]),i}(l),f=-Math.PI/2,w=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),(t=e.call(this,Object(n.a)(Object(n.a)({},a),{},{type:"ship",hitBoxRadius:30,direction:f,acceleration:.1,angularSpeed:Math.PI/3/20,hasTail:!0}))).bullets=[],t.shielded=!1,t.rotationStep=Math.PI/6,t.startingDirection=f,t.rightRotations=0,t.leftRotations=0,t.ACC_SPRINTS=30,t.DEC_SPRINTS=15,t.FUEL_CONSUMPTION=1/3e3,t.sprints=0,t.MAX_SPEED=4,t.SHIELD_DURATION=7e3,t}return Object(a.a)(i,[{key:"update",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)Object(o.a)(Object(r.a)(i.prototype),"update",this).call(this),Object(p.remove)(this.bullets,{isExpired:!0}),this.bullets.forEach((function(t){return t.update()})),this.modifySpeed()}},{key:"turnLeft",value:function(){this.setTargetDirection(this.getComputedDirection()-this.rotationStep),this.leftRotations++}},{key:"turnRight",value:function(){this.setTargetDirection(this.getComputedDirection()+this.rotationStep),this.rightRotations++}},{key:"accelerate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.sprints>0?this.sprints+=this.ACC_SPRINTS:this.sprints=this.ACC_SPRINTS}},{key:"decelerate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;e<t;e++)this.sprints<0?this.sprints+=-this.DEC_SPRINTS:this.sprints=-this.DEC_SPRINTS}},{key:"fire",value:function(){var t=this.makeBullet();return this.bullets.push(t),t}},{key:"restoreLife",value:function(){this.life=1}},{key:"activateShield",value:function(){var t=this;this.shielded=!0,setTimeout((function(){t.shielded=!1}),this.SHIELD_DURATION)}},{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{bullets:this.bullets.map((function(t){return t.serialize()})),shielded:this.shielded})}},{key:"modifySpeed",value:function(){this.sprints>0?this.useSprintsToAccelerateForward():this.sprints<0?this.useSprintsToAccelerateBackwards():this.decelerateBackToZero()}},{key:"hasBullet",value:function(t){return Boolean(Object(p.find)(this.bullets,{id:t}))}},{key:"decelerateBackToZero",value:function(){var t;this.speed>0?(t=Math.abs(this.MAX_SPEED-this.speed)/2,this.speed=Math.max(this.speed-this.acceleration*t,0)):this.speed<0&&(t=Math.abs(-this.MAX_SPEED-this.speed)/2,this.speed=Math.min(this.speed+this.acceleration*t,0))}},{key:"useSprintsToAccelerateForward",value:function(){var t=Math.pow(Math.abs(this.MAX_SPEED-this.speed)/2,2);this.speed+=this.acceleration*t,this.sprints--}},{key:"useSprintsToAccelerateBackwards",value:function(){var t=Math.abs(-this.MAX_SPEED-this.speed)/2;this.speed-=this.acceleration*t,this.sprints++}},{key:"getComputedDirection",value:function(){var t=(-this.leftRotations+this.rightRotations)*this.rotationStep;return this.startingDirection+t}},{key:"makeBullet",value:function(){return new v({world:this.world,direction:this.direction,coords:this.coords,speed:Math.max(this.speed,0)+12})}}]),i}(l);function m(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2))}function b(t,e){return m(t.coords,e.coords)<t.hitBoxRadius+e.hitBoxRadius}function g(t,e){var i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=0;do{if(n>100)throw Error("Could not create randomCoordsFarFrom");n++,i=m(s={x:Math.random()*e.width,y:Math.random()*e.height},t.coords)}while(i<t.hitBoxRadius*a);return s}function y(t,e,i){var s;t<0&&(t+=Math.PI);do{s=i()*Math.PI*2}while(Math.abs(s-t)<=e/2);return s}function O(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t<s?t+e:t>i?t-e:t}function k(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t>=i&&t<=e}function j(t,e,i,s,a){var n=t.x-e.x,o=t.y-e.y,r={x:i.width/2+n,y:i.height/2+o};if(a)return r;var h=function(t,e,i){return{x:O(t.x,e.width,i.width),y:O(t.y,e.height,i.height)}}(r,s,i);return k(h.x,i.width)&&k(h.y,i.height)?h:void 0}var x,S=function(){function t(e,i){Object(s.a)(this,t),this.type=void 0,this.id=void 0,this.coords=void 0,this.type=e,this.id=Object(u.a)(),this.coords=Object(n.a)({},i)}return Object(a.a)(t,[{key:"serialize",value:function(){return{type:this.type,id:this.id,coords:Object(n.a)({},this.coords)}}}]),t}(),E=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t,a){var n;return Object(s.a)(this,i),(n=e.call(this,"SHIP_HIT",t.coords)).asteroidId=void 0,n.damage=void 0,n.size=void 0,n.shielded=void 0,n.asteroidId=t.id,n.damage=t.damage,n.size=t.size,n.shielded=a,n}return Object(a.a)(i,[{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{damage:this.damage,size:this.size,shielded:this.shielded})}}]),i}(S),A=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t,a,n){var o;return Object(s.a)(this,i),(o=e.call(this,"BULLET_HIT",t.coords)).bulletId=void 0,o.asteroidId=void 0,o.size=void 0,o.shattered=void 0,o.bulletId=t.id,o.asteroidId=a.id,o.size=a.size,o.shattered=n,o}return Object(a.a)(i,[{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{size:this.size,shattered:this.shattered})}}]),i}(S),T=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(s.a)(this,i),(a=e.call(this,"GOT_BONUS",t.coords)).bonusId=void 0,a.bonusType=void 0,a.bonusId=t.id,a.bonusType=t.dropType,a}return Object(a.a)(i,[{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{bonusType:this.bonusType})}}]),i}(S),R=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t){var a;return Object(s.a)(this,i),(a=e.call(this,Object(n.a)(Object(n.a)({},t),{},{hitBoxRadius:30,type:"drop",rotationSpeed:Math.PI/100}))).dropType=void 0,a.rotatingRight=!0,a.rotationCone=Math.PI/12,a.dropType=t.type,a}return Object(a.a)(i,[{key:"update",value:function(){Object(o.a)(Object(r.a)(i.prototype),"update",this).call(this),this.rotatingRight?this.orientation>this.rotationCone&&(this.changeRotationDirection(),this.rotatingRight=!1):this.orientation<-this.rotationCone&&(this.changeRotationDirection(),this.rotatingRight=!0)}},{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{dropType:this.dropType})}}]),i}(l),z={large:1.5,medium:3,small:5},I={large:40,medium:30,small:20},C={large:.2,medium:.15,small:.1},B=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,i);var n=Math.random()>.5?1:-1,o=a.size||"large";return(t=e.call(this,{world:a.world,coords:a.coords,hitBoxRadius:I[o],speed:z[o],type:"asteroid",direction:a.direction||Math.random()*Math.PI*2,rotationSpeed:a.rotationSpeed||n*Math.PI/50,angularSpeed:Math.PI/3/40})).size=void 0,t.damage=void 0,t.size=o,t.damage=C[o],t}return Object(a.a)(i,[{key:"update",value:function(){Object(o.a)(Object(r.a)(i.prototype),"update",this).call(this),Math.random()>.995&&this.changeDirection()}},{key:"splitSize",value:function(){return"large"===this.size?"medium":"medium"===this.size?"small":null}},{key:"serialize",value:function(){return Object(n.a)(Object(n.a)({},Object(o.a)(Object(r.a)(i.prototype),"serialize",this).call(this)),{},{size:this.size,damage:this.damage})}},{key:"changeDirection",value:function(){var t=Math.PI/3,e=Math.random()>.5?1:-1,s=this.direction+t*e;Object(o.a)(Object(r.a)(i.prototype),"setTargetDirection",this).call(this,s)}}]),i}(l),M=function(){function t(e,i){Object(s.a)(this,t),this.state=void 0,this.world=void 0,this.nextBonusSpawnAt=void 0,this.nextAsteroidSpawnAt=void 0,this.asteroidTimer=void 0,this.bonusTimer=void 0,this.HIT_BOX_MULTIPLIER=5,this.CONE_ANGLE=Math.PI/3,this.state=e,this.world=i,this.nextAsteroidSpawnAt=1/0,this.nextBonusSpawnAt=1/0}return Object(a.a)(t,[{key:"getEtas",value:function(){return{asteroids:this.nextAsteroidSpawnAt-Date.now(),bonuses:this.nextBonusSpawnAt-Date.now()}}},{key:"spawnBonus",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.state.bonuses,i=[],s=0;s<(t.count||1);s++){var a=this.makeDropOptions(t),n=new R(a);e.push(n),i.push(n)}return i}},{key:"spawnAsteroid",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.state.asteroids,i=[],s=0;s<(t.count||1);s++){var a=this.makeAsteroidOptions(t),n=new B(a);e.push(n),i.push(n)}return i}},{key:"asteroidEvery",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.nextAsteroidSpawnAt=Date.now()+t,this.asteroidTimer=setInterval((function(){e.spawnAsteroid(i),e.nextAsteroidSpawnAt=Date.now()+t}),t)}},{key:"makeDropOptions",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.type)t=e.type;else{var i=Math.random();t=i<1/3?"fix":i<2/3?"freeze":"shield"}var s=e.coords||g(this.state.ship,this.world,this.HIT_BOX_MULTIPLIER);return{type:t,world:this.world,coords:s}}},{key:"makeAsteroidOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Math.random()*Math.PI*2;return t.notDirection&&(e=y(t.notDirection,this.CONE_ANGLE,Math.random)),{size:t.size||"large",world:this.world,coords:t.coords||g(this.state.ship,this.world,this.HIT_BOX_MULTIPLIER),direction:e}}}]),t}(),D=function(){function t(e){var i;Object(s.a)(this,t),this.state=void 0,this.status="idle",this.world=void 0,this.spawner=void 0,this.gameOverCallback=void 0,this.gameWonCallback=void 0,this.snapshotTimeout=void 0,this.state={asteroids:[],bonuses:[],events:[],ship:new w({world:e,coords:(i=e,{x:i.width/2,y:i.height/2})}),score:0,level:1,frozen:!1},this.world=e,this.spawner=new M(this.state,this.world)}return Object(a.a)(t,[{key:"startLevel",value:function(t){var e=this,i=this.spawner;this.status="playing",i.spawnAsteroid({count:30}),i.asteroidEvery(5e3,{count:5}),this.snapshotTimeout=setInterval((function(){t(e.createSnapshot())}),16)}},{key:"onGameOver",value:function(t){this.gameOverCallback=t}},{key:"onGameWon",value:function(t){this.gameWonCallback=t}},{key:"update",value:function(){this.state.ship.update(),this.updateAsteroids(this.state.frozen),this.updateBonuses(),this.checkCollisions(),this.updateLevel(),this.checkGameWon(),this.checkGameLost()}},{key:"countAsteroids",value:function(t){return Object(p.filter)(this.state.asteroids,{size:t}).length}},{key:"hasAsteroid",value:function(t){return Boolean(Object(p.find)(this.state.asteroids,{id:t}))}},{key:"getAsteroidsCount",value:function(){return{large:this.countAsteroids("large"),medium:this.countAsteroids("medium"),small:this.countAsteroids("small")}}},{key:"createSnapshot",value:function(){this.update();var t=this.spawner.getEtas(),e=this.state,i=e.ship,s=e.asteroids,a=e.bonuses,n=e.events,o={score:this.state.score,level:this.state.level,world:this.world,createdAt:Date.now(),status:this.status,etas:t,ship:i.serialize(),asteroids:s.map((function(t){return t.serialize()})),bonuses:a.map((function(t){return t.serialize()})),events:n.map((function(t){return t.serialize()})),frozen:this.state.frozen};return this.state.events=[],o}},{key:"checkGameLost",value:function(){var t;this.state.ship.life<=0&&(this.status="lost",this.snapshotTimeout&&clearInterval(this.snapshotTimeout),null===(t=this.gameOverCallback)||void 0===t||t.call(this))}},{key:"checkGameWon",value:function(){var t;0===this.state.asteroids.length&&(this.status="won",this.snapshotTimeout&&clearInterval(this.snapshotTimeout),null===(t=this.gameWonCallback)||void 0===t||t.call(this))}},{key:"updateAsteroids",value:function(t){t||this.state.asteroids.forEach((function(t){t.update()}))}},{key:"updateBonuses",value:function(){this.state.bonuses.forEach((function(t){t.update()}))}},{key:"checkCollisions",value:function(){this.checkAsteroidBulletCollisions(),this.checkAsteroidShipCollisions(),this.checkBonusShipCollisions()}},{key:"checkAsteroidBulletCollisions",value:function(){var t=this,e=this.state,i=e.asteroids,s=e.ship,a=e.events;i.forEach((function(e){s.bullets.forEach((function(i){if(b(e,i)){var s=new A(i,e,t.state.frozen);a.push(s),t.processBulletHit(s),t.assignScore(s)}}))}))}},{key:"checkAsteroidShipCollisions",value:function(){var t=this,e=this.state,i=e.asteroids,s=e.ship,a=e.events;i.forEach((function(e){if(b(e,s)){var i=new E(e,s.shielded);a.push(i),t.processShipHit(i),t.assignScore(i)}}))}},{key:"checkBonusShipCollisions",value:function(){var t=this,e=this.state,i=e.bonuses,s=e.ship,a=e.events;i.forEach((function(e){if(b(e,s)){var i=new T(e);a.push(i),t.processGotBonus(i)}}))}},{key:"processBulletHit",value:function(t){var e=this.state,i=e.asteroids,s=e.ship,a=Object(p.find)(i,{id:t.asteroidId});if(a){this.createLoot(a.coords);var n=a.splitSize();n&&!this.state.frozen&&this.spawner.spawnAsteroid({count:2,size:n,coords:a.coords,notDirection:this.state.ship.direction}),Object(p.remove)(i,{id:t.asteroidId})}else console.log("ship has collided with asteroid at previous update");Object(p.remove)(s.bullets,{id:t.bulletId})}},{key:"assignScore",value:function(t){var e={large:50,medium:100,small:200};t instanceof A&&(this.state.frozen?"large"===t.size?this.state.score+=e.large+2*e.medium+4*e.small:"medium"===t.size?this.state.score+=e.medium+2*e.small:this.state.score+=e.small:this.state.score+=e[t.size])}},{key:"updateLevel",value:function(){this.state.level=Math.floor(this.state.score/2600)+1}},{key:"processShipHit",value:function(t){var e=this.state,i=e.asteroids,s=e.ship;Object(p.remove)(i,{id:t.asteroidId}),s.shielded||(s.life-=t.damage)}},{key:"processGotBonus",value:function(t){var e=this,i=this.state,s=i.ship,a=i.bonuses;switch(t.bonusType){case"fix":s.restoreLife();break;case"shield":s.activateShield();break;case"freeze":this.state.frozen=!0,setTimeout((function(){e.state.frozen=!1}),5e3)}Object(p.remove)(a,{id:t.bonusId})}},{key:"createLoot",value:function(t){Math.random()>.95&&this.spawner.spawnBonus({coords:t})}}]),t}(),_=function(){function t(){Object(s.a)(this,t),this.engine=void 0,this.container=void 0,this.engine=new D({width:4e3,height:2e3}),this.container=document.getElementById("root")}return Object(a.a)(t,[{key:"start",value:function(){this.on("start",this.handleStartRequest),this.on("command",this.handleCommand)}},{key:"on",value:function(t,e){this.container.addEventListener(t,e.bind(this))}},{key:"handleStartRequest",value:function(t){this.engine.startLevel(this.sendSnapshotToClient.bind(this)),this.container.dispatchEvent(new Event("started"))}},{key:"sendSnapshotToClient",value:function(t){this.container.dispatchEvent(new CustomEvent("snapshot",{detail:t}))}},{key:"handleCommand",value:function(t){var e,i,s=t.detail;null===(e=(i=this.engine.state.ship)[s])||void 0===e||e.call(i)}}]),t}(),P=i(8),L=i.n(P),W=i(9);!function(t){t[t.ARROW_LEFT=37]="ARROW_LEFT",t[t.ARROW_RIGHT=39]="ARROW_RIGHT",t[t.ARROW_UP=38]="ARROW_UP",t[t.ARROW_DOWN=40]="ARROW_DOWN",t[t.SPACE_BAR=32]="SPACE_BAR",t[t.LETTER_H=72]="LETTER_H",t[t.LETTER_P=80]="LETTER_P"}(x||(x={}));var H=function(){function t(e){Object(s.a)(this,t),this.rootElementId=e}return Object(a.a)(t,[{key:"pressed",value:function(t){switch(t){case x.ARROW_LEFT:return this.sendCommand("turnLeft");case x.ARROW_RIGHT:return this.sendCommand("turnRight");case x.ARROW_UP:return this.sendCommand("accelerate");case x.ARROW_DOWN:return this.sendCommand("decelerate");case x.SPACE_BAR:return this.sendCommand("fire")}}},{key:"sendCommand",value:function(t){document.getElementById(this.rootElementId).dispatchEvent(new CustomEvent("command",{detail:t}))}}]),t}(),G=20;var N=function(){function t(e,i){Object(s.a)(this,t),this.p5=void 0,this.colors=void 0,this.p5=e,this.colors=i}return Object(a.a)(t,[{key:"draw",value:function(t){this.drawShipInfo(t.ship),this.drawScore(t)}},{key:"drawAsteroidsInfo",value:function(t){var e=this.p5,i={x:G,y:80},s=Object(p.filter)(t,{size:"large"}).length,a=Object(p.filter)(t,{size:"medium"}).length,n=Object(p.filter)(t,{size:"small"}).length;e.text("asteroids: ".concat(s," | ").concat(a," | ").concat(n),i.x,i.y)}},{key:"drawShipInfo",value:function(t){var e=t.life,i=(t.speed,this.p5);i.fill("white"),i.noStroke(),i.textAlign(i.LEFT),i.text("life: ".concat((100*e).toFixed(0)+"%"),20,20)}},{key:"drawTimersInfo",value:function(t){var e=this.p5,i=e.windowWidth-100;e.text("Asteroids in: ".concat((t.asteroids/1e3).toFixed(0),"s"),i,20)}},{key:"drawScore",value:function(t){var e=this.p5;e.textAlign(e.CENTER),e.text(t.score,e.windowWidth/2,G),e.text("Level ".concat(t.level),e.windowWidth/2,40)}}]),t}(),F={freeze:"#0CA789",inactive:"#808080",life:"#F24726",shield:"#E6E6E6",hud:"#2D9BF0",space:"black"},U=function(){function t(e){Object(s.a)(this,t),this.frameCount=e,this.isExpired=!1,this.currentFrame=0}return Object(a.a)(t,[{key:"next",value:function(){return this.currentFrame>=this.frameCount-1?(this.isExpired=!0,!1):this.currentFrame++}}]),t}(),X=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t,a){var n;return Object(s.a)(this,i),(n=e.call(this,t)).color=void 0,n.color=a,n}return i}(U),q=function(t){Object(h.a)(i,t);var e=Object(c.a)(i);function i(t,a,n){var o;return Object(s.a)(this,i),(o=e.call(this,t.length)).frames=void 0,o.coords=void 0,o.scale=void 0,o.frames=t,o.coords=a,o.scale=n,o}return Object(a.a)(i,[{key:"getNextFrame",value:function(){return!!Object(o.a)(Object(r.a)(i.prototype),"next",this).call(this)&&{coords:this.coords,direction:0,hitBoxRadius:60,orientation:0,image:this.frames[this.currentFrame],currentFrame:this.currentFrame,scale:this.scale}}}]),i}(U),J=function(){function t(e){Object(s.a)(this,t),this.p5=void 0,this.stars=[],this.assets=void 0,this.showHitBoxes=void 0,this.screen=void 0,this.gui=void 0,this.snapshot=void 0,this.animations=[],this.p5=e.p5,this.p5.createCanvas(this.p5.windowWidth,this.p5.windowHeight).parent(e.rootElementId),this.assets=e.assets,this.showHitBoxes=e.showHitBoxes||!1,this.screen={width:this.p5.windowWidth,height:this.p5.windowHeight},this.gui=new N(this.p5,F)}return Object(a.a)(t,[{key:"updateSnapshot",value:function(t){t&&(this.snapshot||this.createStars(t.world,200),this.snapshot=t)}},{key:"drawScreen",value:function(){if(this.snapshot)switch(this.snapshot.status){case"playing":this.drawGameScreen(this.snapshot);break;case"lost":this.drawGameOverScreen(this.snapshot.score);break;case"won":this.drawGameWonScreen(this.snapshot.score);break;case"idle":console.log("idle")}}},{key:"resizeScreen",value:function(t,e){this.p5.resizeCanvas(t,e),this.screen={width:t,height:e}}},{key:"drawGameScreen",value:function(t){this.drawEnvironment(),this.drawGameObjects(t),this.createNewAnimations(t),this.drawAnimations(),this.gui.draw(t)}},{key:"drawGameOverScreen",value:function(t){var e=this.p5;e.background(F.space),e.fill("yellow"),e.textAlign(e.CENTER),e.text("GAME OVER",e.windowWidth/2,e.windowHeight/2),e.text(t,e.windowWidth/2,e.windowHeight/2+30),e.text("press F5 to try again",e.windowWidth/2,e.windowHeight/2+60),e.textAlign(e.LEFT)}},{key:"drawGameWonScreen",value:function(t){var e=this.p5;e.background(F.space),e.fill("yellow"),e.textAlign(e.CENTER),e.text("GAME WON!",e.windowWidth/2,e.windowHeight/2),e.text(t,e.windowWidth/2,e.windowHeight/2+30),e.text("press F5 to try again",e.windowWidth/2,e.windowHeight/2+60),e.textAlign(e.LEFT)}},{key:"drawEnvironment",value:function(){var t=this.p5,e=this.stars;t.background(F.space),this.drawStars(e)}},{key:"drawGameObjects",value:function(t){var e=t.ship,i=t.bonuses,s=t.asteroids;this.drawBullets(e.bullets),this.drawShip(e),this.drawBonuses(i),this.drawAsteroids(s,t.frozen)}},{key:"createNewAnimations",value:function(t){var e=this;t.events.forEach((function(i){if("GOT_BONUS"!==i.type){var s=e.assets[t.frozen?"shatterAnimation":"explosionAnimation"];if(e.animations.push(new q(s,i.coords,1)),"SHIP_HIT"===i.type)i.shielded||e.animations.push(new X(30,"red"))}else{var a,n=i;a="shield"===n.bonusType?"green":"freeze"===n.bonusType?"blue":"white",e.animations.push(new X(30,a))}}))}},{key:"drawAnimations",value:function(){var t=this,e=this.p5;this.animations.forEach((function(i){if(i instanceof q){var s=i.getNextFrame();s&&t.drawGameObject(s,{image:s.image})}else if(i instanceof X){var a=i.next();if(a){var n=(i.frameCount-a)/i.frameCount*128,o=i.color;"red"===o?e.fill(128,0,0,n):"green"===o?e.fill(0,128,0,n):"blue"===o?e.fill(0,200,255,n):e.fill(128,128,128,n),e.rectMode(e.CORNER),e.noStroke(),e.rect(0,0,t.screen.width,t.screen.height)}}})),this.animations=this.animations.filter((function(t){return!t.isExpired}))}},{key:"createStars",value:function(t,e){for(var i=0;i<e;i++)this.stars.push({x:Math.random()*t.width,y:Math.random()*t.height,radius:Math.random()>.5?2:1})}},{key:"drawableCoords",value:function(t){var e,i;return j(t,(null===(e=this.snapshot)||void 0===e?void 0:e.ship.coords)||{x:0,y:0},this.screen,(null===(i=this.snapshot)||void 0===i?void 0:i.world)||{width:1e3,height:1e3})}},{key:"drawStars",value:function(t){var e=this,i=this.p5;i.noStroke(),i.fill("white"),t.forEach((function(t){var s=e.drawableCoords(t);s&&i.circle(s.x,s.y,t.radius)}))}},{key:"drawBonuses",value:function(t){var e=this;t.forEach((function(t){e.drawGameObject(t,{image:e.assets.images[t.dropType]})}))}},{key:"drawAsteroids",value:function(t,e){var i=this;t.forEach((function(t){i.drawGameObject(t,{image:i.assets.images["".concat(e?"frozen-":"","asteroid")]})}))}},{key:"drawGameObject",value:function(t,e){var i=this.p5,s=this.drawableCoords(t.coords);if(!s)return!1;var a=2*t.hitBoxRadius;return i.imageMode(i.CENTER),i.push(),i.translate(s.x,s.y),i.rotate(t.orientation),i.rotate(e.rotateDirection?t.direction:0),i.rotate(e.rotationOffset||0),i.image(e.image,0,0,a,a),this.showHitBoxes&&(i.noFill(),i.stroke("red"),i.circle(0,0,a)),i.pop(),!0}},{key:"drawShip",value:function(t){var e=this,i=this.p5;t.tail.forEach((function(s,a){var n=10*(1-(t.tail.length-a)/t.tail.length+1),o=255*(1-(t.tail.length-a)/t.tail.length);i.noStroke(),i.fill(50,50,50,o);var r=e.drawableCoords(s);r&&i.circle(r.x,r.y,n)})),t.shielded&&(i.stroke(0,255,0,128),i.fill(0,55,0,128),i.circle(i.windowWidth/2,i.windowHeight/2,80)),this.drawGameObject(t,{image:this.assets.images.ship,rotateDirection:!0,rotationOffset:Math.PI/2})}},{key:"drawBullets",value:function(t){var e=this;t.forEach((function(t){e.drawGameObject(t,{image:e.assets.images.bullet})}))}}]),t}();function Z(t,e){return new Promise((function(i,s){t.loadImage(e,(function(t){return i(t)}),(function(t){return s(t)}))}))}function V(t,e,i){for(var s=[],a=0;a<=e;a++){var n=i(a);s.push(Z(t,n))}return Promise.all(s)}function K(t){return V(t,31,(function(t){var e=t.toString().padStart(2,"0");return"./assets/explosion/expl_06_00".concat(e,".png")}))}function Q(t){return V(t,17,(function(t){return"./assets/shatter/Blue Ring Explosion".concat(t+1,".png")}))}function Y(t){var e={},i=["asteroid","ship","fix","shield","freeze","bullet","frozen-asteroid"];return new Promise(function(){var s=Object(W.a)(L.a.mark((function s(a,n){return L.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Promise.all(i.map((function(e){return Z(t,"./assets/".concat(e,".png"))})));case 3:s.sent.forEach((function(t,s){e[i[s]]=t})),a(e),s.next=11;break;case 8:s.prev=8,s.t0=s.catch(0),n("Failed to load image assets");case 11:case"end":return s.stop()}}),s,null,[[0,8]])})));return function(t,e){return s.apply(this,arguments)}}())}function $(t){return tt.apply(this,arguments)}function tt(){return(tt=Object(W.a)(L.a.mark((function t(e){return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y(e);case 2:return t.t0=t.sent,t.next=5,K(e);case 5:return t.t1=t.sent,t.next=8,Q(e);case 8:return t.t2=t.sent,t.abrupt("return",{images:t.t0,explosionAnimation:t.t1,shatterAnimation:t.t2});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var et="root",it=function(t){var e,i,s=new H(et),a=!1,n={images:{},explosionAnimation:[],shatterAnimation:[]};t.preload=Object(W.a)(L.a.mark((function t(){return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),t.setup=Object(W.a)(L.a.mark((function s(){var o,r;return L.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,$(t);case 2:n=s.sent,(o=document.getElementById(et)).addEventListener("snapshot",(function(t){i=t.detail})),setTimeout((function(){o.dispatchEvent(new Event("start"))}),1e3),t.frameRate(60),e=new J({p5:t,assets:n,rootElementId:et,showHitBoxes:!1}),r=document.getElementById("loading"),document.body.removeChild(r),a=!0;case 11:case"end":return s.stop()}}),s)}))),t.keyPressed=function(){s.pressed(t.keyCode)},t.windowResized=function(){console.log("resized"),a&&e.resizeScreen(t.windowWidth,t.windowHeight)},t.draw=function(){a&&(e.updateSnapshot(i),e.drawScreen())}},st=i(11),at=i.n(st);(new _).start(),new at.a(it)}},[[16,1,2]]]);
//# sourceMappingURL=main.c722b087.chunk.js.map